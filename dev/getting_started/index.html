<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting started · MMCAcovid19.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MMCAcovid19.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li class="is-active"><a class="tocitem" href>Getting started</a><ul class="internal"><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Installation-and-usage"><span>Installation and usage</span></a></li><li><a class="tocitem" href="#Model-data"><span>Model data</span></a></li><li><a class="tocitem" href="#Running-the-model"><span>Running the model</span></a></li></ul></li><li><a class="tocitem" href="../library/">Library</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting started</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jtmatamalas/MMCAcovid19.jl/blob/master/docs/src/getting_started.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="#Getting-Started">Getting Started</a></li><ul><li><a href="#Contents">Contents</a></li><li><a href="#Installation-and-usage">Installation and usage</a></li><li><a href="#Model-data">Model data</a></li><ul><li><a href="#Geographic-and-population-data">Geographic and population data</a></li><li><a href="#Epidemic-parameters">Epidemic parameters</a></li><li><a href="#Initialization-of-the-epidemics">Initialization of the epidemics</a></li><li><a href="#Containment-strategy">Containment strategy</a></li></ul><li><a href="#Running-the-model">Running the model</a></li></ul></ul><h2 id="Installation-and-usage"><a class="docs-heading-anchor" href="#Installation-and-usage">Installation and usage</a><a id="Installation-and-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-and-usage" title="Permalink"></a></h2><p>Installation:</p><pre><code class="language-julia">] add MMCAcovid19</code></pre><p>Usage:</p><pre><code class="language-julia">using MMCAcovid19</code></pre><h2 id="Model-data"><a class="docs-heading-anchor" href="#Model-data">Model data</a><a id="Model-data-1"></a><a class="docs-heading-anchor-permalink" href="#Model-data" title="Permalink"></a></h2><p>The execution of the model depends on the following input data:</p><ul><li>Geographic and population data.</li><li>Epidemic parameters.</li><li>Initialization of the epidemics.</li><li>Containment strategy.</li></ul><p>For a good simulation, you need to find real data or appropriate estimates for all of them. We suppose all this information can be read from external sources, feeding the corresponding Julia variables. In what follows, we first initialize all the necessary data, sometimes using random values, to show the correct way to introduce them to our model, and finally we show how to run the model.</p><h3 id="Geographic-and-population-data"><a class="docs-heading-anchor" href="#Geographic-and-population-data">Geographic and population data</a><a id="Geographic-and-population-data-1"></a><a class="docs-heading-anchor-permalink" href="#Geographic-and-population-data" title="Permalink"></a></h3><p>Here we create <em>random</em> geographic and population data just to show the list and structure of the data variables.</p><p>We set first the basic sizes of the system, the number of patches and the number of strata:</p><pre><code class="language-julia"># Number of strata
G = 3

# Number of patches
M = 5</code></pre><p>Now we generate a random population, i.e., the number of people at each strata and patch. We distribute a total population of one million people using a multinomial random number:</p><pre><code class="language-julia"># Random population
using Random
using Distributions

g_probs = [0.1, 0.6, 0.3]
m_probs = [0.05, 0.10, 0.15, 0.30, 0.40]
probs = transpose(m_probs) .* g_probs
total_population = 1000000
distrib = Multinomial(total_population, reshape(probs, (1, G * M))[1, :])
nᵢᵍ = convert.(Float64, reshape(rand(distrib), (G, M)))</code></pre><pre class="documenter-example-output">Total population: 1000000
Matrix nᵢᵍ:
  1:    4995.0    9875.0   14970.0   30010.0   40326.0
  2:   30107.0   59630.0   90009.0  179745.0  239983.0
  3:   15145.0   29827.0   45086.0   90266.0  120026.0</pre><p>Note that, for convenience, we have used Float64 instead of integers to hold the sizes of the population. Now, the matrix of probabilities of contacts between strata, with all rows summing to one:</p><pre><code class="language-julia"># Strata contacts
C = [0.5980 0.3849 0.0171
     0.2440 0.7210 0.0350
     0.1919 0.5705 0.2376]</code></pre><p>For the generation of the random mobility matrix, we first create a random directed network between patches, add self-loops to each node to represent people for which work and residence patches coincide, assign random weights to all the edges, and normalize the output weights to represent the commuting probabilities. The result is a two-column matrix <em>edgelist</em> with the origins and destinations of each edge, and a vector <em>R</em> with the corresponding commuting probabilities:</p><pre><code class="language-julia"># Random mobility
using LightGraphs

# network
network = erdos_renyi(M, 0.7, is_directed=true)
for i in 1:M
  add_edge!(network, i, i)   # add self-loops
end
# list of edges
L = ne(network)
edgelist = zeros(Int64, L, 2)
edgelist[:, 1] .= src.(edges(network))
edgelist[:, 2] .= dst.(edges(network))
# list of commuting probabilities
Rᵢⱼ = rand(L)
sum_r = zeros(M)
for e in 1:L   # find output strengths
  i = edgelist[e, 1]
  sum_r[i] += Rᵢⱼ[e]
end
for e in 1:L   # normalize weights
  i = edgelist[e, 1]
  Rᵢⱼ[e] /= sum_r[i]
end</code></pre><pre class="documenter-example-output">Mobility matrix R:
  1 -&gt; 1 : 0.128441
  1 -&gt; 2 : 0.421710
  1 -&gt; 3 : 0.065699
  1 -&gt; 4 : 0.057292
  1 -&gt; 5 : 0.326857
  2 -&gt; 1 : 0.218382
  2 -&gt; 2 : 0.407707
  2 -&gt; 5 : 0.373911
  3 -&gt; 1 : 0.128047
  3 -&gt; 2 : 0.219577
  3 -&gt; 3 : 0.190232
  3 -&gt; 4 : 0.289372
  3 -&gt; 5 : 0.172772
  4 -&gt; 1 : 0.367028
  4 -&gt; 2 : 0.295921
  4 -&gt; 3 : 0.294488
  4 -&gt; 4 : 0.026881
  4 -&gt; 5 : 0.015681
  5 -&gt; 3 : 0.379312
  5 -&gt; 4 : 0.145112
  5 -&gt; 5 : 0.475577</pre><p>Finally, the rest of the variables related to population:</p><pre><code class="language-julia"># Average number of contacts per strata
kᵍ = [11.8, 13.3, 6.6]

# Average number of contacts at home per strata
kᵍ_h = [3.15, 3.17, 3.28]

# Average number of contacts at work per strata
kᵍ_w = [1.72, 5.18, 0.0]

# Degree of mobility per strata
pᵍ = [0.0, 1.0, 0.05]

# Patch surfaces (in km²)
sᵢ = [10.6, 23.0, 26.6, 5.7, 61.6]

# Density factor
ξ = 0.01

# Average household size
σ = 2.5</code></pre><p>Now, we are in condition to create the data structure to hold all the parameters related with the geographic area and its population:</p><pre><code class="language-julia">population = Population_Params(G, M, nᵢᵍ, kᵍ, kᵍ_h, kᵍ_w, C, pᵍ, edgelist, Rᵢⱼ, sᵢ, ξ, σ)</code></pre><h3 id="Epidemic-parameters"><a class="docs-heading-anchor" href="#Epidemic-parameters">Epidemic parameters</a><a id="Epidemic-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Epidemic-parameters" title="Permalink"></a></h3><p>The epidemic parameters control the probabilities of transition between the different compartments, and are summarized in the model diagram:</p><p><img src="../figs/Fig-model.png" alt="Model"/></p><p>Thus, we must set them all according to the reported values in the scientific literature. Here we set the values in reference [<a href="../index.html#References-1">1</a>] of <a href="../#References">References</a>:</p><pre><code class="language-julia"># Infectivity of infected
βᴵ = 0.075

# Infectivity of asymptomatic
βᴬ = 0.5 * βᴵ

# Exposed rate
ηᵍ = [1/2.444, 1/2.444, 1/2.444]

# Asymptomatic infectious rate
αᵍ = [1/5.671, 1/2.756, 1/2.756]

# Infectious rate
μᵍ = [1/1.0, 1/3.915, 1/3.915]

# Direct death probability
θᵍ = [0.0, 0.008, 0.047]

# ICU probability
γᵍ = [0.0003, 0.003, 0.026]

# Pre-deceased rate
ζᵍ = [1/7.084, 1/7.084, 1/7.084]

# Pre-hospitalized in ICU rate
λᵍ = [1/4.084, 1/4.084, 1/4.084]

# Fatality probability in ICU
ωᵍ = [0.3, 0.3, 0.3]

# Death rate in iCU
ψᵍ = [1/7.0, 1/7.0, 1/7.0]

# ICU discharge rate
χᵍ = [1/20.0, 1/20.0, 1/20.0]</code></pre><p>Additionally, we must set the number of timesteps (equivalent to days) to run the model equations:</p><pre><code class="language-julia"># Number of timesteps
T = 200</code></pre><p>With them, we create the corresponding data structure:</p><pre><code class="language-julia"># Epidemic parameters
epi_params = Epidemic_Params(βᴵ, βᴬ, ηᵍ, αᵍ, μᵍ, θᵍ, γᵍ, ζᵍ, λᵍ, ωᵍ, ψᵍ, χᵍ, G, M, T)</code></pre><h3 id="Initialization-of-the-epidemics"><a class="docs-heading-anchor" href="#Initialization-of-the-epidemics">Initialization of the epidemics</a><a id="Initialization-of-the-epidemics-1"></a><a class="docs-heading-anchor-permalink" href="#Initialization-of-the-epidemics" title="Permalink"></a></h3><p>The initialization of the epidemic spreading is performed by introducing the initial number of infected individuals (exposed, asymptomatic and symptomatic) at each patch and strata.</p><pre><code class="language-julia"># Initial number of exposed individuals
E₀ = zeros(G, M)

# Initial number of infectious asymptomatic individuals
A₀ = zeros(G, M)
A₀[2, 5] = 2.0
A₀[3, 3] = 1.0

# Initial number of infectious symptomatic individuals
I₀ = zeros(G, M)
I₀[2, 5] = 1.0</code></pre><pre class="documenter-example-output">Initial number of exposed E₀:
  1:  0.0  0.0  0.0  0.0  0.0
  2:  0.0  0.0  0.0  0.0  0.0
  3:  0.0  0.0  0.0  0.0  0.0
Initial number of infectious asymptomatic A₀:
  1:  0.0  0.0  0.0  0.0  0.0
  2:  0.0  0.0  0.0  0.0  2.0
  3:  0.0  0.0  1.0  0.0  0.0
Initial number of infectious symptomatic I₀:
  1:  0.0  0.0  0.0  0.0  0.0
  2:  0.0  0.0  0.0  0.0  1.0
  3:  0.0  0.0  0.0  0.0  0.0</pre><p>Now we apply the initialization:</p><pre><code class="language-julia">set_initial_infected!(epi_params, population, E₀, A₀, I₀)</code></pre><h3 id="Containment-strategy"><a class="docs-heading-anchor" href="#Containment-strategy">Containment strategy</a><a id="Containment-strategy-1"></a><a class="docs-heading-anchor-permalink" href="#Containment-strategy" title="Permalink"></a></h3><p>The containment strategy relies on the timestep at which the containment is applied, the mobility reduction, the permeablity of confined households, and the social distancing:</p><pre><code class="language-julia"># Timestep of application of containment
tᶜ = 30

# Mobility reduction
κ₀ = 0.65

# Permeability of confined households
ϕ = 0.174

# Social distancing
δ = 0.207</code></pre><p>To apply multiple containments at different timesteps, just put them in lists:</p><pre><code class="language-julia"># List of timesteps of application of containments
tᶜs = [30, 60, 90, 120]

# List of mobility reductions
κ₀s = [0.65, 0.75, 0.65, 0.55]

# List of permeabilities of confined households
ϕs = [0.174, 0.174, 0.174, 0.174]

# List of social distancings
δs = [0.207, 0.207, 0.207, 0.207]</code></pre><h2 id="Running-the-model"><a class="docs-heading-anchor" href="#Running-the-model">Running the model</a><a id="Running-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-model" title="Permalink"></a></h2><p>Let us summarize first the preparation of the data to feed the model:</p><pre><code class="language-julia">using MMCAcovid19

# Geographic and population data
population = Population_Params(G, M, nᵢᵍ, kᵍ, kᵍ_h, kᵍ_w, C, pᵍ, edgelist, Rᵢⱼ, sᵢ, ξ, σ)

# Epidemic parameters
epi_params = Epidemic_Params(βᴵ, βᴬ, ηᵍ, αᵍ, μᵍ, θᵍ, γᵍ, ζᵍ, λᵍ, ωᵍ, ψᵍ, χᵍ, G, M, T)

# Initialization of infectious people
set_initial_infected!(epi_params, population, E₀, A₀, I₀)</code></pre><p>With this information we can run the model:</p><pre><code class="language-julia"># Run the model
run_epidemic_spreading_mmca!(epi_params, population; verbose = true)</code></pre><p>To include a containment strategy, just add the corresponding parameters:</p><pre><code class="language-julia"># Run the model with a single containment strategy
run_epidemic_spreading_mmca!(epi_params, population; tᶜ = tᶜ, κ₀ = κ₀, ϕ = ϕ, δ = δ)</code></pre><p>Otherwise, if multiple containment strategies are needed:</p><pre><code class="language-julia"># Run the model with a single containment strategy
run_epidemic_spreading_mmca!(epi_params, population, tᶜs, κ₀s, ϕs, δs; verbose = false)</code></pre><p>The results can be stored to files using:</p><pre><code class="language-julia"># Output path and suffix for results files
output_path = &quot;output/folder&quot;
suffix = &quot;run01&quot;

# Store compartments
store_compartment(epi_params, population, &quot;S&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;E&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;A&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;I&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;PH&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;PD&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;HR&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;HD&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;R&quot;, suffix, output_path)
store_compartment(epi_params, population, &quot;D&quot;, suffix, output_path)</code></pre><p>If you are interested in the evolution of the effective reproduction number <em>R</em> for each strata and patch, or the total one, you can calculate or store them to file:</p><pre><code class="language-julia"># Optional kernel length
τ = 21

# Calculate effective reproduction number R
Rᵢᵍ_eff, R_eff = compute_R_eff(epi_params, population, τ)

# Calculate and store effective reproduction number R
store_R_eff(epi_params, population, suffix, output_path, τ)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Overview</a><a class="docs-footer-nextpage" href="../library/">Library »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 26 April 2021 19:26">Monday 26 April 2021</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
